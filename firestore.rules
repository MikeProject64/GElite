rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Global site configuration, readable by all, writable only by admins.
    match /siteConfig/{docId} {
      allow read: if true; // Publicly readable for feature flags, site name, etc.
      allow write: if request.auth.token.role == 'admin';
    }

    // User-specific settings, only accessible by the user themselves.
    match /userSettings/{userId} {
      allow read, write: if request.auth.uid == userId;
    }
    
    // User collection:
    // Regular users can read/update their own data.
    // Admins can read/update any user's data.
    match /users/{userId} {
      allow read, update: if request.auth.uid == userId;
      allow read, update: if request.auth.token.role == 'admin';
    }

    // Default security for all other collections:
    // Users can only access documents where their UID matches the 'userId' field.
    match /{collection}/{docId} {
      allow read, write: if request.auth.uid == resource.data.userId;
    }
  }
}
