rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Path for service order attachments: serviceOrders/{orderId}/{fileName}
    match /serviceOrders/{orderId}/{allPaths=**} {
      // Allow read/write only if the user is authenticated and is the owner of the service order document in Firestore.
      allow read, write: if request.auth != null &&
                          get(/databases/$(database)/documents/serviceOrders/$(orderId)).data.userId == request.auth.uid;
    }
  }
}
