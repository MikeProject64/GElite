rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Files for service orders can only be uploaded by the owner of the service order.
    match /serviceOrders/{orderId}/{fileName} {
      allow write: if request.auth != null &&
                      get(/databases/$(database)/documents/serviceOrders/$(orderId)).data.userId == request.auth.uid;
      
      // Reading is allowed for the owner as well.
      allow read: if request.auth != null &&
                     get(/databases/$(database)/documents/serviceOrders/$(orderId)).data.userId == request.auth.uid;
    }
  }
}
